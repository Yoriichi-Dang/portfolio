---
import type { CollectionEntry } from 'astro:content';
import { BaseHead } from '@/shared/ui/base';
import { FormattedDate } from '@/shared/lib/utils';
import { GridBackground } from '@/shared/ui/molecules/Background/GridBackground';
import { PortfolioNavigation } from '@/pages/portfolio/PortfolioNavigation';
import { ZoomableHeroImage } from '@/features/blog/ui/ZoomableHeroImage';
type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

const heroImageSrc = typeof heroImage === 'string' ? heroImage : heroImage?.src;
const heroImageWidth = typeof heroImage === 'string' ? 1200 : (heroImage?.width ?? 1200);
const heroImageHeight = typeof heroImage === 'string' ? 600 : (heroImage?.height ?? 600);
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <script is:inline>
      // Initialize theme from localStorage before page renders (prevent flash)
      (function () {
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground min-h-screen w-full">
    <div class="relative flex overflow-x-hidden">
      <GridBackground>
        <PortfolioNavigation client:load />
        <main class="mx-auto mt-16 px-4 md:px-8 lg:px-10">
          <article
            class="font-merriweather mx-auto w-full px-3 py-4 sm:px-4 sm:py-6 md:px-6 md:py-8"
          >
            <header
              class="mx-auto mb-8 flex w-full max-w-5xl flex-col items-center justify-center pb-6 sm:mb-10 sm:pb-8"
            >
              <h1
                class="text-foreground mb-3 text-2xl leading-tight font-bold sm:mb-4 sm:text-3xl md:text-4xl lg:text-[2.5rem]"
              >
                {title}
              </h1>
              <div
                class="text-muted-foreground flex flex-wrap items-center gap-x-4 gap-y-2 text-base"
              >
                <div class="flex items-center gap-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="size-4"
                  >
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <FormattedDate date={pubDate} />
                </div>
                {
                  updatedDate && (
                    <div class="flex items-center gap-2 text-sm italic">
                      Updated: <FormattedDate date={updatedDate} />
                    </div>
                  )
                }
              </div>
            </header>
            {
              heroImageSrc && (
                <div class="mx-auto w-full max-w-6xl">
                  <ZoomableHeroImage
                    client:load
                    src={heroImageSrc}
                    alt={title}
                    width={heroImageWidth}
                    height={heroImageHeight}
                  />
                </div>
              )
            }
            <div class="mx-auto w-full max-w-5xl pt-10">
              <div
                class="prose dark:prose-invert prose-xs sm:prose-sm md:prose-lg lg:prose-lg prose-img:rounded-xl prose-pre:overflow-x-auto font-merriweather mx-auto w-full max-w-5xl wrap-break-word"
              >
                <slot />
              </div>
            </div>
          </article>
        </main>
      </GridBackground>
    </div>
  </body>
</html>
