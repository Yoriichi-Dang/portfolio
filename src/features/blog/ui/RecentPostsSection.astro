---
import { getCollection } from 'astro:content';
import { FormattedDate } from '@/shared/lib/utils';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3); // Get latest 3 posts
---

<section id="blog" class="bg-muted pb-20">
  <div class="container mx-auto px-4">
    <div class="mx-auto max-w-6xl">
      <h2 class="text-foreground mb-4 text-center text-4xl font-bold md:text-5xl">
        Latest Blog Posts
      </h2>
      <p class="text-muted-foreground mb-12 text-center text-lg">
        Thoughts, tutorials, and insights about web development
      </p>

      <div class="grid gap-8 md:grid-cols-3">
        {
          posts.map((post) => {
            const heroImage = post.data.heroImage;
            const isPublicImage = typeof heroImage === 'string';

            return (
              <article class="group border-border bg-card overflow-hidden rounded-xl border shadow-lg transition-all duration-300 hover:shadow-2xl">
                <a href={`/blog/${post.id}/`} class="block">
                  {heroImage && (
                    <div class="bg-muted relative h-48 overflow-hidden">
                      <img
                        src={isPublicImage ? heroImage : heroImage.src}
                        alt={post.data.title}
                        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-110"
                      />
                    </div>
                  )}

                  <div class="p-6">
                    <div class="text-muted-foreground mb-3 flex items-center gap-2 text-sm">
                      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        />
                      </svg>
                      <FormattedDate date={post.data.pubDate} />
                    </div>

                    <h3 class="text-card-foreground group-hover:text-primary mb-2 line-clamp-2 text-xl font-bold transition-colors">
                      {post.data.title}
                    </h3>

                    <p class="text-muted-foreground mb-4 line-clamp-3">{post.data.description}</p>

                    <div class="text-primary flex items-center gap-2 font-medium">
                      Read more
                      <svg
                        class="h-4 w-4 transition-transform group-hover:translate-x-1"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        />
                      </svg>
                    </div>
                  </div>
                </a>
              </article>
            );
          })
        }
      </div>

      <div class="mt-12 text-center">
        <a
          href="/blog"
          class="hover:bg-primary/10 border-primary text-primary inline-flex items-center gap-2 rounded-lg border-2 px-8 py-3 font-medium transition-colors duration-200"
        >
          View All Posts
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>
