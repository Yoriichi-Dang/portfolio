---
import { BlogList } from '@/features/blog';
import { getCollection } from 'astro:content';
import { toBlogPostDisplay } from '@/entities/blog';
import { IconArrowRight } from '@tabler/icons-react';

// Fetch real blog posts from content collection
const allPosts = await getCollection('blog');

// Filter out drafts and sort by date
const publishedPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Convert to display format
const posts = publishedPosts.map(toBlogPostDisplay);

const limit = 4;
const showViewAll = true;
---

<section id="blog" class="pb-40">
  <div class="container mx-auto px-4">
    <div class="mx-auto max-w-7xl">
      {/* Heading with View All Link */}
      <div class="mb-12 flex items-center justify-between">
        <h2 class="text-foreground text-2xl font-semibold md:text-3xl">Latest Blog Posts</h2>

        {
          showViewAll && (
            <a
              href="/blog"
              class="text-muted-foreground hover:text-foreground group inline-flex items-center gap-2 text-base transition-colors md:text-lg"
            >
              <span>View all posts</span>
              <IconArrowRight className="size-5 transition-transform group-hover:translate-x-1" />
            </a>
          )
        }
      </div>

      {/* Blog List */}
      <BlogList posts={posts} limit={limit} />
    </div>
  </div>
</section>
