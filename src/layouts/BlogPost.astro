---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { BaseHead } from '@/shared/ui/base';
import { FormattedDate } from '@/shared/lib/utils';
import { GridBackground } from '@/shared/ui/molecules/Background/GridBackground';
import { PortfolioNavigation } from '@/pages/portfolio/PortfolioNavigation';
type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// Check if heroImage is a string (public folder) or ImageMetadata (src/assets/)
const isPublicImage = typeof heroImage === 'string';
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <script is:inline>
      // Initialize theme from localStorage before page renders (prevent flash)
      (function () {
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground min-h-screen w-full">
    <div class="relative flex overflow-x-hidden">
      <GridBackground>
        <PortfolioNavigation client:load />
        <main class="mx-auto mt-16 max-w-5xl px-4 md:px-8 lg:px-10">
          <article class="mx-auto w-full px-3 py-4 sm:px-4 sm:py-6 md:px-6 md:py-8">
            {
              heroImage && (
                <div class="mx-auto mb-6 aspect-video w-full overflow-hidden rounded-xl">
                  {isPublicImage ? (
                    <img src={heroImage} alt={title} class="block h-full w-full object-cover" />
                  ) : (
                    <Image
                      src={heroImage}
                      alt={title}
                      width={1200}
                      height={600}
                      class="block h-full w-full object-cover"
                    />
                  )}
                </div>
              )
            }
            <div class="mx-auto w-full">
              <header class="border-border mb-8 border-b pb-6 sm:mb-10 sm:pb-8">
                <h1
                  class="text-foreground mb-3 text-2xl leading-tight font-bold sm:mb-4 sm:text-3xl md:text-4xl lg:text-[2.5rem]"
                >
                  {title}
                </h1>
                <div
                  class="text-muted-foreground flex flex-wrap items-center gap-x-4 gap-y-2 text-sm sm:text-[0.9375rem]"
                >
                  <div class="flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="size-4"
                    >
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <FormattedDate date={pubDate} />
                  </div>
                  {
                    updatedDate && (
                      <div class="flex items-center gap-2 text-sm italic">
                        Updated: <FormattedDate date={updatedDate} />
                      </div>
                    )
                  }
                </div>
              </header>
              <div
                class="prose dark:prose-invert prose-sm sm:prose-base md:prose-lg lg:prose-xl prose-img:rounded-xl prose-pre:overflow-x-auto mx-auto w-full px-2 wrap-break-word sm:px-4"
              >
                <slot />
              </div>
            </div>
          </article>
        </main>
      </GridBackground>
    </div>
  </body>
</html>
