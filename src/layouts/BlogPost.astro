---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { BaseHead } from '@/shared/ui/base';
import { FormattedDate } from '@/shared/lib/utils';
import { GridBackground } from '@/shared/ui/molecules/Background/GridBackground';
import { PortfolioNavigation } from '@/pages/portfolio/PortfolioNavigation';
type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// Check if heroImage is a string (public folder) or ImageMetadata (src/assets/)
const isPublicImage = typeof heroImage === 'string';
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <script is:inline>
      // Initialize theme from localStorage before page renders (prevent flash)
      (function () {
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground">
    <div class="relative flex min-h-screen w-full overflow-x-hidden">
      <GridBackground>
        <PortfolioNavigation client:load />
        <main class="m-0 w-full max-w-full pt-8">
          <article class="mx-auto max-w-[1200px] px-4 py-6 md:px-6 md:py-8">
            {
              heroImage && (
                <div class="mx-auto mb-8 w-full max-w-[1200px] overflow-hidden rounded-2xl md:mb-12">
                  {isPublicImage ? (
                    <img
                      src={heroImage}
                      alt={title}
                      class="block h-auto max-h-[500px] w-full object-cover"
                    />
                  ) : (
                    <Image
                      src={heroImage}
                      alt={title}
                      width={1200}
                      height={600}
                      class="block h-auto max-h-[500px] w-full object-cover"
                    />
                  )}
                </div>
              )
            }
            <div class="mx-auto max-w-[800px] px-4">
              <header class="border-border mb-12 border-b pb-8">
                <h1
                  class="text-foreground mb-4 text-3xl leading-tight font-bold md:text-4xl lg:text-[2.5rem]"
                >
                  {title}
                </h1>
                <div
                  class="text-muted-foreground flex flex-wrap items-center gap-4 text-[0.9375rem]"
                >
                  <div class="flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="size-4"
                    >
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <FormattedDate date={pubDate} />
                  </div>
                  {
                    updatedDate && (
                      <div class="mt-2 flex items-center gap-2 text-sm italic">
                        Updated: <FormattedDate date={updatedDate} />
                      </div>
                    )
                  }
                </div>
              </header>
              <div class="prose dark:prose-invert">
                <slot />
              </div>
            </div>
          </article>
        </main>
      </GridBackground>
    </div>
  </body>
</html>
